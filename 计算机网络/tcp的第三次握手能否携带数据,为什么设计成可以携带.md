### 一、TCP 三次握手的基本流程

1. **客户端 → 服务器**：发送 SYN 包，请求建立连接，携带初始序列号（ISN）。
2. **服务器 → 客户端**：发送 SYN+ACK 包，确认客户端的 SYN，同时携带自己的 ISN。
3. **客户端 → 服务器**：发送 ACK 包，确认服务器的 SYN。此时连接建立完成。

### 二、第三次握手为何允许携带数据？

1. **减少 RTT（Round-Trip Time）**
    - 如果第三次握手不允许携带数据，客户端在连接建立后还需单独发送数据，增加一次 RTT（往返延迟）。
    - 允许携带数据后，客户端可以在确认连接的同时发送业务数据，将两次通信合并为一次，减少一次 RTT，提升效率。
    - **示例**：HTTP/1.1 的 `Connection: keep-alive` 模式下，客户端可以在第三次握手中直接发送 HTTP 请求，无需等待连接建立完成后再单独发送。
2. **避免资源浪费**
    - 服务器在第二次握手（SYN+ACK）后已分配了 TCP 缓冲区和相关资源。如果客户端必须等待连接建立后再发送数据，可能导致服务器资源短暂闲置。
    - 允许第三次握手携带数据，客户端可以立即利用已分配的资源传输数据，避免浪费。
3. **协议灵活性**
    - 并非所有场景都需要在第三次握手中携带数据（如纯控制连接），因此 TCP 设计为**可选**携带数据。客户端可以根据业务需求决定是否在 ACK 中捎带数据。

### 三、对比其他握手协议

- **UDP**：无握手过程，直接发送数据，但不可靠。
- **SSL/TLS 握手**：在 TCP 连接建立后进行，其第三次握手（客户端发送 Finished 消息）也允许携带应用层数据（如 HTTP 请求），同样是为了减少延迟。

### 四、注意事项

1. **服务器必须支持**
    - 若服务器未准备好接收数据（如资源不足），可能拒绝或丢弃第三次握手中的数据，需客户端重试。
2. **数据大小限制**
    - 第三次握手中携带的数据受限于 MSS（最大段大小），通常为 1460 字节（MTU 1500 - IP 头 20 - TCP 头 20）。
3. **安全性考量**
    - 恶意客户端可能利用此特性发送大量数据进行 DoS 攻击，因此服务器通常会限制初始数据包的大小或进行速率控制。

### 总结

TCP 第三次握手允许携带数据是为了**减少一次 RTT 延迟**和**提高资源利用率**，尤其适用于短连接或需要快速响应的场景（如 Web 请求）。这一设计体现了 TCP 在可靠性与效率之间的平衡。